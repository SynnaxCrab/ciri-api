language: node_js

#before_install:
#  - curl -sfLO https://raw.githubusercontent.com/apex/up/master/install.sh

install:
  #  - sh install.sh -b ./bin 0.4.5
  # - ./bin/up version
  - sudo chown -R $(whoami) /usr/local/bin
  - curl -sf https://up.apex.sh/install | sh
  - up upgrade
  - up version
  - yarn global add node-prune
  - yarn

cache: yarn

script:
  - yarn test

deploy:
  provider: script
  script: sh ./up-deploy.sh
  skip_cleanup: true
  on:
    branch: master

after_success:
  - ./bin/up url

env:
  global:
    AWS_REGION: us-west-2
