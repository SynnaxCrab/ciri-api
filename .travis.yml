language: node_js

before_install:
  - curl -sfLO https://raw.githubusercontent.com/apex/up/master/install.sh

install:
  - sh install.sh -b ./bin 0.3.6
  - ./bin/up version
  - yarn global add node-prune
  - yarn

cache: yarn

script:
  - yarn test

deploy:
  provider: script
  script: sh ./up-deploy.sh
  skip_cleanup: true
  on:
    branch: master

after_success:
  - ./bin/up url

env:
  global:
    AWS_REGION: us-west-2